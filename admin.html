<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shraddha Scholars – Admin</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      padding: 2rem;
    }

    h2 {
      color: #0b1f3a;
      margin-bottom: 1rem;
    }

    input, button, select {
      padding: 10px;
      margin: 5px 5px 5px 0;
      font-size: 1rem;
    }

    button {
      cursor: pointer;
      background: #0b1f3a;
      color: white;
      border: none;
      padding: 10px 16px;
    }

    button:hover {
      opacity: 0.9;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1.5rem;
      background: white;
    }

    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }

    th {
      background: #0b1f3a;
      color: white;
    }

    .error {
      color: red;
      margin-top: 10px;
      font-weight: bold;
    }

    .contacted {
      color: green;
      font-weight: bold;
    }

    .not-contacted {
      color: red;
      font-weight: bold;
    }

    /* Login Card */
    #loginBox {
      max-width: 400px;
      margin: 120px auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
      text-align: center;
    }

    #dashboard {
      display: none;
    }
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <h2>Shraddha Scholars</h2>
  <p style="color:#555;margin-bottom:20px;">Admin Login</p>

  <input
    type="password"
    id="adminPass"
    placeholder="Enter admin password"
    style="width:100%;"
    onkeydown="if(event.key==='Enter') loadData()"
  >

  <button onclick="loadData()" style="width:100%;margin-top:10px;">
    Login
  </button>

  <p class="error" id="errorMsg"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard">

  <h2>Admin Dashboard – Shraddha Scholars</h2>

  <input type="text" id="searchBox" placeholder="Search name / phone">
  <select id="courseFilter">
    <option value="">All Courses</option>
    <option value="IOQM">IOQM</option>
    <option value="NMTC">NMTC</option>
    <option value="CBSE">CBSE</option>
    <option value="ICSE">ICSE</option>
  </select>

  <table id="dataTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Class</th>
        <th>School</th>
        <th>Phone</th>
        <th>Course</th>
        <th>Status</th>
        <th>Delete</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

</div>

<script>
  let allData = [];
  let adminPassword = "";

  async function loadData() {
    adminPassword = document.getElementById("adminPass").value;
    const errorMsg = document.getElementById("errorMsg");

    errorMsg.innerText = "";

    if (!adminPassword) {
      errorMsg.innerText = "Please enter admin password.";
      return;
    }

    try {
      const res = await fetch("https://shraddha-scholars.onrender.com/api/enquiry", {
        headers: { "x-admin-password": adminPassword }
      });

      if (!res.ok) throw new Error("Unauthorized");

      allData = await res.json();

      document.getElementById("loginBox").style.display = "none";
      document.getElementById("dashboard").style.display = "block";

      renderTable();

    } catch (err) {
      errorMsg.innerText = "Wrong password or server error.";
    }
  }

  function renderTable() {
    const body = document.getElementById("tableBody");
    const search = document.getElementById("searchBox").value.toLowerCase();
    const filter = document.getElementById("courseFilter").value;

    body.innerHTML = "";

    allData
      .filter(e =>
        (!filter || e.course === filter) &&
        (e.name.toLowerCase().includes(search) || e.phone.includes(search))
      )
      .forEach(e => {
        const row = document.createElement("tr");

        row.innerHTML = `
          <td>${e.name}</td>
          <td>${e.class}</td>
          <td>${e.school || "-"}</td>
          <td>${e.phone}</td>
          <td>${e.course || "-"}</td>
          <td>
            <button onclick="toggleStatus(this)">
              Not Contacted
            </button>
          </td>
          <td>
            <button onclick="deleteRow(this)">Delete</button>
          </td>
          <td>${new Date(e.createdAt).toLocaleString()}</td>
        `;

        body.appendChild(row);
      });
  }

  function toggleStatus(btn) {
    if (btn.innerText === "Not Contacted") {
      btn.innerText = "Contacted";
      btn.className = "contacted";
    } else {
      btn.innerText = "Not Contacted";
      btn.className = "not-contacted";
    }
  }

  function deleteRow(btn) {
    if (!confirm("Delete this enquiry?")) return;
    btn.closest("tr").remove();
  }

  document.getElementById("searchBox").addEventListener("input", renderTable);
  document.getElementById("courseFilter").addEventListener("change", renderTable);
</script>

</body>
</html>
